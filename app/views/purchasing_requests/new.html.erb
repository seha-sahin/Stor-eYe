<% @suppliers.each do |supplier| %>
  <% wines = @wines_by_supplier[supplier.id] %>
  <% next if wines.blank? %>

  <h2><%= supplier.name %></h2>
  <hr>

  <%= form_with(model: @purchasing_request, local: true, data: { controller: "purchasing-request-form" }) do |form| %>
    <%= form.hidden_field :supplier_id, value: supplier.id %>
    <%= form.fields_for :pr_quantity do |pr_quantity_form| %>
      <% wines.each do |wine| %>
        <div class="form-group">
          <%= pr_quantity_form.label "wines[#{wine.id}]", wine.maker %>
          <%= pr_quantity_form.number_field "wines[#{wine.id}]", min: 0, class: "form-control" %>
        </div>
      <% end %>
    <% end %>

    <div class="form-group">
      <%= form.label :delivery_date %>
      <%= form.date_field :delivery_date, class: "form-control", required: true %>
    </div>

    <div class="form-group">
      <%= form.label :delivery_time_slot %>
      <%= form.select :delivery_time_slot, %w[Morning Afternoon Evening], { prompt: "Select a Time Slot" }, class: "form-control", required: true %>
    </div>

    <%= form.submit 'Submit', class: "btn btn-primary" %>
  <% end %>
<% end %>
